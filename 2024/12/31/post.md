---
date: 2024-12-31
day: ุงูุซูุงุซุงุก
tags: []
---

ููู ูููุณ ุฃุฏุงุก ุงููุธุงู ุจุงุณุชุฎุฏุงู ุงูู Percentilesุ ๐ค

ูุซูุฑ ูุง ูุณูุน ุนู p50 ู p90 ู p95 ู p99 ูู ุณูุงู ููุงุณ ุฃุฏุงุก ุงูุฃูุธูุฉุ ูููู ุดู ูุนูู ูุฐุง ุงูููุงู ูููุด ุจูุณุชุฎุฏููุ

ุฃููุง ุฎูููุง ูููู ุดู ูู ุงูู Percentile: ุจุจุณุงุทุฉุ ุงูู Percentile ูู ูููุฉ ุชุฎุจุฑู ุฃู ูุณุจุฉ ูุนููุฉ ูู ุงูุจูุงูุงุช ุฃูู ูู ุฃู ุชุณุงูู ูููุฉ ูุนููุฉ. ุนูู ุณุจูู ุงููุซุงูุ ุฅุฐุง ูุงู p90 ูุณุงูู 100 ููุฐุง ูุนูู ุฃู 90% ูู ุงูุจูุงูุงุช ุฃูู ูู ุฃู ุชุณุงูู ูุฐู ุงููููุฉ ู 10ูช ุฃูุจุฑ ูู ุฃู ูุฐู ุงููููุฉ.

ุทูุจุ ููุด ุจูุณุชุฎุฏู ุงูู Percentiles ุจุฏู ุงููุชูุณุทุ ๐คจ

ุชุฎูู ูุนู ุงูุชุงูู: ุนูุฏู ูุธุงู ูุจุฏู ุชููุณ ุฒูู ุงูุงุณุชุฌุงุจุฉ ูููุ ูุนูุฏู 100 ุทูุจ ูุตูู ูููุธุงู:
- 90 ุทูุจ ุงุณุชุบุฑููุง 100ms
- 9 ุทูุจุงุช ุงุณุชุบุฑููุง 200ms
- ุทูุจ ูุงุญุฏ ุงุณุชุบุฑู 10 ุซูุงูู (ุฃู 10000ms)

ุงููุชูุณุท ูู ูุฐู ุงูุญุงูุฉ: ((90 * 100) + (9 * 200) + (1 * 10000)) / 100 = 290ms

ูู ูุฐุง ุงูุฑูู ูุนูุณ ูุงูุน ุงููุธุงูุ ุฃููุฏ ูุง! ูุฃู ุงููุชูุณุท ูุชุฃุซุฑ ุจุดูู ูุจูุฑ ุจุงูููู ุงูููุชุทุฑููุฉ ุฃู ุงูู Outliersุ ููู ุญุงูุชูุง 99% ูู ุงููุณุชุฎุฏููู ูุง ุดุงููุง ูุฐุง ุงูุฒูู ุฃุตูุง ๐

ููู ุจุชูุฌู ุฃูููุฉ ุงูู Percentiles ููู ุญุงูุฉ ุงููุธุงู ุงูุณุงุจู ูู ูุงูุชุงูู:

- p50 (ูู ุงูุบุงูุจ ูู ููุณู ุงููุณูุท ุฃู Median): 100ms

ูุนูู ุฃู 50% ูู ุงูุทูุจุงุช ูุงูุช ุฃุณุฑุน ูู ุฃู ุชุณุงูู 100ms ู50% ูุงูุช ุฃุจุทุฃ.

- p90: 200ms

ูุนูู ุฃู 90% ูู ุงูุทูุจุงุช ูุงูุช ุฃุณุฑุน ูู ุฃู ุชุณุงูู 200ms ู10% ููุท ูุงูุช ุฃุจุทุฃ.

- p99: 10000ms

ูุดูุฑ ุฅูู ุฃุณูุฃ 1% ูู ุงูุทูุจุงุชุ ูุงูุชู ูุงูุช ุจุทูุฆุฉ ููุบุงูุฉ.

ูุฐู ุงูุฃุฑูุงู ุชุนุทูู ุตูุฑุฉ ุฃูุถุญ ุนู ุฃุฏุงุก ุงููุธุงูุ ูุชูุฏุฑ ุชุญุฏุฏ ููู ุงููุดููุฉ ุจุงูุถุจุท ุญุณุจ ููุนูุฉ ุงูุทูุจุงุช ูู ูู ุดุฑูุญุฉ ูู ุดุฑุงุฆุญ ุงูู Percentile.

ุทูุจุ ููู ูุญุณุจ ุงูู Percentiles ูู SQL ุนูู ุฌุฏูู ูุจูุฑุ ๐ค

ูู PostgreSQL ุนูุฏู ุฏุงูุฉ ุฌุงูุฒุฉ ุงุณููุง `percentile_cont`ุ ุงุณุชุฎุฏุงููุง ุณูู:

```sql
SELECT
  percentile_cont(0.5) WITHIN GROUP (ORDER BY response_time) as p50,
  percentile_cont(0.9) WITHIN GROUP (ORDER BY response_time) as p90,
  percentile_cont(0.95) WITHIN GROUP (ORDER BY response_time) as p95,
  percentile_cont(0.99) WITHIN GROUP (ORDER BY response_time) as p99
FROM requests;
```

ูููู ุงููุดููุฉ ุฃู ูุฐู ุงูุฏุงูุฉ ุจุชุญุชุงุฌ ุชูุฑุฃ ูู ุงูุจูุงูุงุช ูุชุฑุชุจููุ ููุฐุง ูุด ุนููู ุนูู ุงูุฌุฏุงูู ุงููุจูุฑุฉ.

ุงูุญูุ ุงุณุชุฎุฏุงู ุชูุฑูุจ ุฃู Approximation ูุน ุฏุงูุฉ `percentile_disc`:

```
SELECT
  percentile_disc(0.5) WITHIN GROUP (ORDER BY response_time) as p50,
  percentile_disc(0.9) WITHIN GROUP (ORDER BY response_time) as p90,
  percentile_disc(0.95) WITHIN GROUP (ORDER BY response_time) as p95,
  percentile_disc(0.99) WITHIN GROUP (ORDER BY response_time) as p99
FROM (
  SELECT response_time 
  FROM requests 
  TABLESAMPLE SYSTEM(1)
) as sample;
```

ูุฐุง ุงูููุฏ ุจูุงุฎุฐ ุนููุฉ ุนุดูุงุฆูุฉ 1% ูู ุงูุจูุงูุงุช ูุจุญุณุจ ุนูููุง ุงูู Percentiles. ุงููุชูุฌุฉ ูุด ุฏูููุฉ 100% ูููููุง ูุงููุฉ ูู ูุนุธู ุงูุญุงูุงุช ุฅุฐุง ูุงู ุงูุฌุฏูู ูุจูุฑ ูุงูุจูุงูุงุช ูุชุฌุงูุณุฉ.

ูุชู ูุณุชุฎุฏู ูู Percentileุ
- p50 ูุนุทูู ุงูุตูุฑุฉ ุงูุนุงูุฉ ููุฃูุธูุฉ ูู ุงููุถุน ุงูุทุจูุนู
- p90 ู p95 ูุณุงุนุฏุงู ูู ุชุญุฏูุฏ ุงููุดุงูู ุงููุญุชููุฉ ูุจู ุฃู ุชุชุฃุซุฑ ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ุงููุณุชุฎุฏููู
- p99 ูุถูุงู ุชุฌุฑุจุฉ ุฌูุฏุฉ ุญุชู ูููุณุชุฎุฏููู ูู ุงูุญุงูุงุช ุงูุดุงุฐุฉ ุฏุงุฎู ูุธุงูู

ูุตูุญุฉ: ูุง ุชูุชูู ุจูุฑุงูุจุฉ ุงููุชูุณุทุ ุงุณุชุฎุฏู ุงูู Percentiles ูููู ุฃุนูู ูุฃุฏุงุก ูุธุงูู ๐ฏ

ูุงูุณูุงู ุนูููู ๐๐ป
