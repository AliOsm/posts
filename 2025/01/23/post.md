---
date: 2025-01-23
day: ุงูุฎููุณ
tags: [ruby-on-rails]
---

ูุง ูู ุงุณุชุนูุงูุงุช ุณ+1 ุฃู N+1 Queries ๐ค (ุงูุฅุตุฑุงุฑ ุนูู ุงูุชุนุฑูุจ ๐)

ุชุฎููู ุฃู ูุฏูู ูุฌููุนุฉ ูู ููุงุฆู ุงูุชุดุบููุ ููู ูุงุฆูุฉ ุชุดุบูู ุชุญุชูู ุนูู ูุฌููุนุฉ ูู ุงูููุงุฏ ุงููุฑุฆูุฉ ุฃู ุงููุณููุนุฉุ ูุฃูุช ุชุฑูุฏ ุนุฑุถ ููุงุฆู ุงูุชุดุบูู ูู ุงูุตูุญุฉ ูุชุฑูุฏ ุนุฑุถ ุนุฏุฏ ุงูููุงุฏ ุงูููุฌูุฏุฉ ูู ูู ูุงุฆูุฉ ุชุดุบูู.

ุงูุฃูุฑ ุณููุ ูุญุชุงุฌ ูุฅุญุถุงุฑ ููุงุฆู ุงูุชุดุบูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุงุณุชุนูุงู ุงูุชุงูู:
SELECT * FROM playlists ORDER BY created_at DESC

ุซู ููู ูุงุฆูุฉ ุชุดุบูู ูููุง ูููู ุจุงุณุชุฎุฏุงู ุงูุงุณุชุนูุงู ุงูุชุงูู ูุญุณุงุจ ุนุฏุฏ ุงูููุงุฏ ุงูููุฌูุฏุฉ ูููุง:
SELECT COUNT(*) FROM media WHERE playlist_id = {playlist_id}

ูุจุฑููุ ูุฐู ูู ุงุณุชุนูุงูุงุช ุณ+1 ๐ฅณ

ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูุงููููุฉ ููุฌูุฏุฉ ูู ุงูุงุณุชุนูุงู ุงูุฃููุ ูููู ุงุญุชุฌุช ููููุงู ุจุงุณุชุนูุงู ุซุงูู ููู ุตู ูู ุงูุตููู ุงููุงุฏูุฉ ูู ุงูุงุณุชุนูุงู ุงูุฃูู ูุญุณุงุจ ุนุฏุฏ ุงูููุงุฏุ ูุฃูุช ูููุฐุช ุงุณุชุนูุงูุง ูุงุญุฏูุง (1) ูุงุญุชุฌุช ุจุนุฏู ูู (ุณ) ูู ุงูุงุณุชุนูุงูุงุชุ ูููุฐุง ุฃุตุจุญุช ุณ+1.

ูุชุทุจููุงุช ูุฐุง ุงูุฃูุฑ ูุซูุฑุฉุ ููุง ุชูู ุนูุฏ ุงููุซุงู ุงููุฐููุฑุ ูููู ููู ูุญู ุงููุดููุฉ ูู ูุฐุง ุงููุซุงูุ

ูู Ruby on Rails ุงูุฃูุฑ ุณูู ุฌุฏุงุ ุชุญุชุงุฌ ูุฅุถุงูุฉ ุนููุฏ ุฌุฏูุฏ ูู ุฌุฏูู ููุงุฆู ุงูุชุดุบูู ุจุงุณู media_countุ ูุนูุฏ ุชุนุฑูู ุงูุนูุงูุฉ ุจูู ููุงุฆู ุงูุชุดุบูู ูุงูููุงุฏ ููููู ุฅุถุงูุฉ ุงูุฎูุงุฑ counter_cache: true ููุง ูู ููุถูุญ ูู ุงูุตูุฑุฉ.

ุจูุฐู ุงูุทุฑููุฉุ ูุจุดูู ุชููุงุฆูุ ุณููุชู ุฅุทุงุฑ ุงูุนูู Rails ุจูุชุงุจุนุฉ ูุชุญุฏูุซ ูููุฉ ูุฐุง ุงูุนููุฏ ุนูุฏ ุฅุถุงูุฉ ุฃู ูุงุฏุฉ ุฌุฏูุฏุฉ ุฅูู ุฃู ูุงุฆูุฉ ุชุดุบูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

ุชุณูู ูุฐู ุงูููุฒุฉ ุจุงุณู Counter Cache ููู ุชุนูู ุนูู ุงูุนูุงูุงุช ุงููุจุงุดุฑุฉ ููุทุ ุฃูุง ุฅุฐุง ุฃุฑุฏุช ุงุณุชุฎุฏุงููุง ุนูู ุงูุนูุงูุงุช ุงูููุชุนุฏููุฉุ ูุณุชุญุชุงุฌ ูุงุณุชุฎุฏุงู ููุชุจุฉ counter_culture:
https://github.com/magnusvk/counter_culture

ูุจุณุจุจ ุดููุน ูุฐุง ุงูุฎุทุฃ ูู ุฃูุทุฑ ุงูุนูู ุงููุฎุชููุฉ ูุณูููุฉ ุงูุชูุงุตู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูู ORMsุ ููุฌุฏ ุฃุฏูุงุช ูุซูุฑุฉ ูุงูุชุดุงู ูุฐุง ุงูููุน ูู ุงูุฃุฎุทุงุก ูุงูุชุนุงูู ูุนูุง ูููุชุจุฉ bullet ุงููุฎุชุตุฉ ูู ุชุชุจุน ูุฐุง ุงูููุน ูู ุงูุงุณุชุนูุงูุงุช ูุชูุจููู ุนูููุง:
https://github.com/flyerhzm/bullet

ูููุชุจุฉ goldiloader ุงูุชู ุชุญุงูู ุญู ุงููุดููุฉ ูู ุฌุฐูุฑูุง ูู ุฎูุงู ุฌูุจ ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ ุงููุทููุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงุณุชุนูุงู ูุงุญุฏุ ุจุฏูุง ูู ูุฌุฑุฏ ุชูุจููู:
https://github.com/salsify/goldiloader

ูุงูุณูุงู ุนูููู ๐๐ป
