---
date: 2025-04-27
day: الأحد
tags: []
---

كدت أُشلّ 🫠

أجريت بعض التعديلات على مكتبة تحويل خلال الأيام الماضية تسمح باستخدام أكثر من Service Account Credentials من GCP لتحويل أكثر من ملف PDF أو صورة في نفس الوقت إلى نصوص:  
https://github.com/ieasybooks/tahweel

وبدأت باستخدام هذا التعديل وكانت النتائج مرضية، فأصبحت قادرا على تحويل الملفات بشكل أسرع من السابق، ولكن حاصرني سؤال قبل قليل: "مكتبة تحويل تُحوّل ملفات الـ PDF إلى صور قبل تحويلها إلى نصوص وتُخزّنها في مجلد واحد مشترك، فهل صور الملفات المختلفة تتداخل؟".

لم أستطع النوم ودخلت على الشيفرة البرمجية من الهاتف للتحقق فوجدت أنني أحتفظ بملفات الصور الخاصة بأكثر من ملف PDF في مجلد عشوائي مشترك 😨:  
https://github.com/ieasybooks/tahweel/blob/main/tahweel/managers/pdf_file_manager.py#L19-L35

ببساطة، هذا يعني أن كل ما كنت أُفرّغه في الفترة الماضية من كتب يحتاج إلى إعادة نظر، خصوصا وأنني كنت أُحوّل مجموعات مختلفة من الكتب بالتوازي على نفس الحاسب.

قبل أن تبدأ نوبة الذعر الداخلية، شغّلت الحاسب ووضعت ملفَّي PDF في مجلد واحد، الأول باللغة العربية والثاني باللغة الإنجليزية وبدأت بتحويلهما إلى نصوص باستخدام تحويل ونظرت في النتائج لأكتشف أن النتائج لا مشكلة فيها، فأعدت الكرة مرة أخرى وكان الأمر نفسه.

في هذه اللحظة أوقفت الشيفرة البرمجية المسؤولة عن حذف ملفات الصور من المجلد المشترك لأنظر فيه وأتأكد من التداخل بين صور الملفات المختلفة بعيني:  
https://github.com/ieasybooks/tahweel/blob/main/tahweel/managers/base_file_manager.py#L104-L106

فلما فتحت المجلد المشترك، رأيت ما هو موضّح في الصورة المرفقة مع المنشور 🤓

ببساطة، قلقي لم يكن في محله، فمكتبة `pdf2image` تستخدم UUID4 تلقائيا في تسمية ملفات الصور الخاصة بكل ملف PDF، فالتداخل شبه مستحيل 🥳

هذا لا يعني أن ما فعلته كان صحيحًا، فالأفضل إنشاء مجلد خاص لكل ملف PDF يجري تحويله إلى نص، ولكن هذا تعديل مستقبليّ قد يساهم أحدكم في تنفيذه 😁

والسلام عليكم 👋🏻
