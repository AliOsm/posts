---
date: 2025-02-03
day: ุงูุงุซููู
tags: [ruby, ruby-on-rails]
---

ูุบุฉ Ruby ูุงุณุชููุงู ุงูุฐุงูุฑุฉ ๐

ูุดุฑูุน ููุตุฉ ุจุงุญุซ ูุงู ุฃูู ูุดุฑูุนู ูุจูุฑู ูู ุฃูุชุจู ุจุฅุทุงุฑ ุนูู Ruby on Rails ุจุนุฏ ุณููุงุช ูู ุงุณุชุฎุฏุงูู ูู ูุดุงุฑูุน ูุฎุชููุฉ ุตุบูุฑุฉ ุฃุฎุฑู.

ุจุนุฏ ุฅุทูุงู ููุตุฉ ุจุงุญุซุ ููุช ููุชูุง ุจูุชุงุจุนุฉ ุงุณุชููุงููุง ูููุนุงูุฌ ูุงูุฐุงูุฑุฉ ูุชุญุณูู ุงูุฃุฏุงุกุ ููู ุงูููุงุญุธุงุช ุงูุชู ููุช ุฃูุงุญุธูุง ุจุดุฏุฉ ุฃู ุงุณุชููุงู ุงูุฐุงูุฑุฉ ูุจุฏุฃ ุตุบูุฑูุง ุนูู ุงูุฎุงุฏู ุซู ูุฒุฏุงุฏ ูุน ูุฑูุฑ ุงูููุชุ ููุฏ ูุจุฏุฃ ุจู 1.5GB ููุตู ุฅูู 20GB ุจุนุฏ ุฃุณุงุจูุน ูู ุชุดุบูู ุงูููุตุฉ.

ูููุช ุฃูุนูุฏ ูุดุฑ ุงูููุตุฉ (Re-deploy) ุนูู ูุชุฑุงุช ูุชุจุงุนุฏุฉ ูุฅุนุงุฏุฉ ุงูุฐุงูุฑุฉ ุฅูู ูุธุงู ุงูุชุดุบูู ูุชุฎููู ุงูุถุบุท ุนู ุงูุฎุงุฏูุ ูููู ููุงุฐุง ูุงู ูุญุฏุซ ูุฐุง ุงูุฃูุฑุ

ูุบุฉ Ruby ููุชูุจุฉ ุจูุบุฉ Cุ ููู ูุง ูุณูู CRuby ุฃู MRI ุงุฎุชุตุงุฑูุง ูู Matz's Ruby Interpreter ู Matz ูู ุงุณู ูููุดุฆ ุงููุบุฉุ ุงููุงุจุงูู Yukihiro Matsumoto.

ููุฌุฏ ููุณุฎ ุฃุฎุฑู ูู ูุบุฉ Ruby ููุชูุจุฉ ุจู Java ูู JRuby ู TruffleRubyุ ูููู ูุฐุง ููุณ ููุถูุนูุง.

ุงููุณุฎุฉ ุงูุฃุตููุฉ ุชุณุชุฎุฏู ูุบุฉ Cุ ููุง ูุนูู ุฃููุง ุชุณุชุฎุฏู `malloc` ุจุดูู ุงูุชุฑุงุถู ูุญุฌุฒ ุงูุฐุงูุฑุฉุ ูุญุณุจ ูููู ุงูุจุณูุท ุงููุชูุงุถุน ูุทุฑููุฉ ุนูู `malloc` ููุณุช ุงูุฃูุถูุ ูููุฌุฏ ุงูุนุฏูุฏ ูู ุงูุจุฏุงุฆู ูู `malloc` ูุซู `jemalloc` ู `tcmalloc` ู `mimalloc`.

ุงูุฌููู ูู ูุฐู ุงูุจุฏุงุฆู ุฃููุง ุจุฏุงุฆู ูุจุงุดุฑุฉุ ูุง ุชุญุชุงุฌ ุฅูู ุงููุซูุฑ ูู ุงูุฅุนุฏุงุฏุงุช (ุนูู ุงูุฃูู ูู ุญุงูุฉ `jemalloc`)ุ ููู ูุง ุชุญุชุงุฌู ูู ุชุซุจูุช ููุชุจุฉ `libjemalloc2` ุนูู ูุธุงู ุชุดุบูู Linux ุซู ุฅุถุงูุฉ ูุณุงุฑูุง ุฅูู ูุชุบูุฑ `LD_PRELOAD`ุ ุนูู ุณุจูู ุงููุซุงู:

```bash
export LD_PRELOAD="$(echo /usr/lib/*/libjemalloc.so.2)"
```

ุจุนุฏ ุงุณุชุจุฏุงู `malloc` ุจู `jemalloc` ูู ููุตุฉ ุจุงุญุซ ุงุณุชูุฑ ุงุณุชููุงู ุงูุฐุงูุฑุฉ ุนูุฏ 4.8GBุ ุฃูุซุฑ ูู ูุตููุง (2.5GB ุชุญุฏูุฏูุง) ููุณุชูููุฉ ูู ููุจู ูููุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุณุชุฎุฏู ูู ุงูููุตุฉ.

ุจูููุงุช ุฃุฎุฑูุ ุงุณุชูุฑ ุงุณุชููุงู ุงูุฐุงูุฑุฉ ุนูุฏ 2.3GBุ ููุฐุง ุจุนุฏ ุฃุดูุฑ ูู ุชุดุบูู ุงูููุตุฉ ุฏูู ุฅุนุงุฏุฉ ูุดุฑูุง.

ุงูุฎุจุฑ ุงูุฌููู ุฃูู ูุจุฏุงูุฉ ูู Rails 7.2 ูุฐู ุงูุฅุนุฏุงุฏุงุช ุชุฃุชู ุฌุงูุฒุฉู ูุน ุงููุดุฑูุน ูู ูุงุญูุฉ ุชุซุจูุช `jemalloc` ุนูู ุงูู Docker image ุงูุฎุงุตุฉ ุจุงููุดุฑูุนุ ููุฐูู ุงุณุชุฎุฏุงูู ูู `docker-entrypoint`.

ููููู ูุฑุงุกุฉ ูุฐู ุงูููุงูุฉ ูู ุงูููุงุฑูุฉ ุจูู `malloc` ูุจุฏุงุฆููุง:  
https://lf-hyperledger.atlassian.net/wiki/spaces/BESU/pages/22156632/Reduce+Memory+usage+by+choosing+a+different+low+level+allocator

ูุงูุณูุงู ุนูููู ๐๐ป
